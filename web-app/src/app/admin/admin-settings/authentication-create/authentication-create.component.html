<section class="mat-typography">
    <admin-breadcrumb [breadcrumbs]="breadcrumbs"></admin-breadcrumb>
</section>
<section class="mat-typography">
    <div class="page-container">
        <div class="content">
            <h1>Create Authentication</h1>
        </div>
    </div>
</section>
<section class="mat-typography">
    <div class="page-container">
        <div class="content">
            <mat-horizontal-stepper linear #stepper>
                <mat-step>
                    <ng-template matStepLabel>Name</ng-template>
                    <mat-form-field appearance="outline">
                        <mat-label>Authentication Name</mat-label>
                        <input matInput placeholder="e.g. Local LDAP" [(ngModel)]="strategy.name" required>
                    </mat-form-field>
                    <div>
                        <button [disabled]="!strategy.name.length" mat-button matStepperNext>Next</button>
                    </div>
                </mat-step>
                <mat-step>
                    <ng-template matStepLabel>Type</ng-template>
                    <mat-form-field appearance="outline">
                        <mat-select [(ngModel)]="strategy.type" [ngModelOptions]="{standalone: true}" id="type"
                            name="type" required #type="ngModel">
                            <mat-option *ngFor="let typeChoice of typeChoices" [value]="typeChoice.type">
                                {{typeChoice.title}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                    <div>
                        <button mat-button matStepperPrevious>Back</button>
                        <button [disabled]="!strategy.type.length" mat-button (click)="loadTemplate()"
                            matStepperNext>Next</button>
                    </div>
                </mat-step>
                <mat-step>
                    <ng-template matStepLabel>Settings</ng-template>
                    <legend>Settings</legend>
                    <table mat-table [dataSource]="dataSource" matSort>
                        <ng-container matColumnDef="key">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> Key </th>
                            <td mat-cell *matCellDef="let setting">{{setting.key}}</td>
                        </ng-container>

                        <ng-container matColumnDef="value">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> Value </th>
                            <td mat-cell *matCellDef="let setting" contenteditable="true"
                                (keyup)="changeValue(setting, $event)">
                                {{setting.value}}</td>
                        </ng-container>

                        <ng-container matColumnDef="delete">
                            <th mat-header-cell *matHeaderCellDef> Delete </th>
                            <td mat-cell *matCellDef="let setting">
                                <button mat-icon-button color="warn"
                                    (click)="$event.stopPropagation(); deleteSetting(setting)">
                                    <mat-icon class="mat-18">delete</mat-icon>
                                </button>
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
                        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                    </table>
                    <section class="mat-typography">
                        <legend class="top-gap">Add Setting</legend>
                        <mat-list-item>
                            <label for="inputKey" class="right-gap">Key</label>
                            <mat-form-field appearance="outline">
                                <input matInput type="text" id="inputKey" name="inputKey" [(ngModel)]="newRow.key"
                                    [ngModelOptions]="{standalone: true}" placeholder="Key" #inputKey="ngModel"
                                    required>
                            </mat-form-field>
                            <label for="inputValue" class="left-gap right-gap">Value</label>
                            <mat-form-field appearance="outline">
                                <input matInput type="text" id="inputValue" name="inputValue" [(ngModel)]="newRow.value"
                                    [ngModelOptions]="{standalone: true}" placeholder="Value" />
                            </mat-form-field>
                            <button class="left-gap" mat-stroked-button color="primary" (click)="addSetting()"
                                [disabled]="inputKey.invalid">
                                <mat-icon>add</mat-icon>Add Row
                            </button>
                        </mat-list-item>
                    </section>
                    <div>
                        <button mat-button matStepperPrevious>Back</button>
                        <button mat-button matStepperNext>Next</button>
                    </div>
                </mat-step>
                <mat-step>
                    <ng-template matStepLabel>Colors</ng-template>
                    <mat-list-item>
                        <mat-label for="textColor"><b>Text Color</b></mat-label>
                        <color-picker [hexColor]="strategy.textColor"
                            (onColorChanged)="colorChanged($event, 'textColor')">
                        </color-picker>
                    </mat-list-item>
                    <mat-list-item>
                        <mat-label for="buttonColor"><b>Button Color</b></mat-label>
                        <color-picker [hexColor]="strategy.buttonColor"
                            (onColorChanged)="colorChanged($event, 'buttonColor')">
                        </color-picker>
                    </mat-list-item>
                    <mat-list-item>
                        <mat-label for="icon"><b>Icon--TODO Implement</b></mat-label>
                        <!--TODO-->
                    </mat-list-item>
                    <legend class="top-gap">Preview</legend>
                    <mat-list-item>
                        <button mat-raised-button
                            [ngStyle]="{'background-color': strategy.buttonColor, 'border-color': strategy.buttonColor}">
                            <mat-icon>shield</mat-icon>
                            <span [ngStyle]="{color: strategy.textColor}">Sign In With {{strategy.name}}
                            </span>
                        </button>
                    </mat-list-item>
                    <div>
                        <button mat-button matStepperPrevious>Back</button>
                        <button mat-button matStepperNext>Next</button>
                    </div>
                </mat-step>
                <mat-step>
                    <ng-template matStepLabel>Done</ng-template>
                    <legend>Summary of {{strategy.name}}</legend>
                    <table mat-table [dataSource]="dataSource" matSort>
                        <ng-container matColumnDef="key">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> Key </th>
                            <td mat-cell *matCellDef="let setting">{{setting.key}}</td>
                        </ng-container>

                        <ng-container matColumnDef="value">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> Value </th>
                            <td mat-cell *matCellDef="let setting">
                                {{setting.value}}</td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="summaryColumns; sticky: true"></tr>
                        <tr mat-row *matRowDef="let row; columns: summaryColumns;"></tr>
                    </table>
                    <mat-divider></mat-divider>
                    <div>
                        <button mat-button matStepperPrevious>Back</button>
                        <button mat-button (click)="reset(); stepper.reset()">Reset</button>
                        <button mat-button (click)="save()"
                            [disabled]="!strategy.type.length || !strategy.name.length">Save</button>
                    </div>
                </mat-step>
            </mat-horizontal-stepper>
        </div>
    </div>
</section>