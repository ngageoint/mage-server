var write = require('../src/write').write,
    geojson = require('../src/geojson'),
    fs = require('fs'),
    prj = require('../src/prj');

var gj = require('./gj.json');
[geojson.point(gj), geojson.line(gj), geojson.polygon(gj)]
    .forEach(function(l) {
    if (l.geometries.length) {
                    write(
                // field definitions
                l.properties,
                // geometry type
                l.type,
                // geometries
                l.geometries,
                finish);
    }
    });

    function finish(err, files) {
    fs.writeFileSync('poly2.shp', toBuffer(files.shp.buffer));
    fs.writeFileSync('poly2.shx', toBuffer(files.shx.buffer));
    fs.writeFileSync('poly2.dbf', toBuffer(files.dbf.buffer));
}

function toBuffer(ab) {
    var buffer = new Buffer(ab.byteLength),
        view = new Uint8Array(ab);
    for (var i = 0; i < buffer.length; ++i) { buffer[i] = view[i]; }
    return buffer;
}
