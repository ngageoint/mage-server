<div ng-controller="AdminEventsController">
  <div cl***REMOVED***="row">
    <div cl***REMOVED***="col-md-2">
      <div cl***REMOVED***="row admin-header">
        <div cl***REMOVED***="col-md-12">
          <span ng-click="refresh()"><i cl***REMOVED***="fa fa-refresh icon-spacer pointer"></i></span>
          <h3 style="display: inline">Events ({{filteredEvents.length}})</h3>
          <a cl***REMOVED***="btn btn-primary pull-right" ng-click="newEvent()"><i cl***REMOVED***="fa fa-plus"></i> New Event</a>

          <hr>
        </div>
      </div>

      <div cl***REMOVED***="form-horizontal">
        <input type="text" cl***REMOVED***="search-query col-md-12 form-control" placeholder="Search events" ng-model="eventSearch" ng-change="page=0">
      </div>

      <div cl***REMOVED***="row">
        <div cl***REMOVED***="col-md-12">
          <ul cl***REMOVED***="pager">
            <li cl***REMOVED***="previous" ng-show="page != 0">
              <a ng-click="page=page-1">&larr; Previous</a>
            </li>
            <li cl***REMOVED***="next" ng-show="page < (filteredEvents.length/itemsPerPage) - 1">
              <a ng-click="page=page+1">Next &rarr;</a>
            </li>
          </ul>
        </div>
      </div>

      <div cl***REMOVED***="pointer bottom-gap-s"
          ng-cl***REMOVED***="{'admin-active': event.id == e.id}"
          ng-click="editEvent(e)"
          ng-repeat="e in (filteredEvents = (events | events:eventSearch)) | orderBy:'name' | offset: page*itemsPerPage | limitTo:itemsPerPage">
        <div cl***REMOVED***="admin-row row">
          <div cl***REMOVED***="col-md-12">
            <div cl***REMOVED***="strong">{{e.name}}</div>
            <div cl***REMOVED***="muted">{{e.description}}</div>
          </div>
        </div>
      </div>
    </div>

    <div cl***REMOVED***="col-md-10" ng-show="event">
      <div style="position: fixed; top: 84px; left: 50%" cl***REMOVED***="fade alert alert-success" ng-cl***REMOVED***="{'in': saved, 'out': !saved}">
        Successfully Saved The Event
      </div>
      <h2>Details</h2>
        <div ng-show="event">

          <form cl***REMOVED***="form">
            <div cl***REMOVED***="row">
              <div cl***REMOVED***="col-md-3">
                <div cl***REMOVED***="form-group">
                  <label>Name</label>
                  <input type="text" name="event-name" ng-change="autoSave()" placeholder="Event name" ng-model="event.name" cl***REMOVED***="form-control"/>
                </div>
              </div>
            </div>

            <div cl***REMOVED***="row">
              <div cl***REMOVED***="col-md-3">
                <div cl***REMOVED***="form-group">
                  <label>Description</label>
                  <textarea type="text" ng-change="autoSave()" placeholder="Brief description of the event." ng-model="event.description" cl***REMOVED***="form-control"/>
                </div>
              </div>
            </div>

            <div cl***REMOVED***="row">
              <div cl***REMOVED***="col-md-3">
                <div cl***REMOVED***="form-group" ng-hide="event.id">
                  <label>Form</label>
                  <div file-browser></div>
                  <span cl***REMOVED***="help-block">Optionally import form.  If no form archive is picked your event will start with a default form</span>
                </div>
              </div>
            </div>
          </form>

          <a cl***REMOVED***="btn right" ng-show="form.id" ng-href="{{'/api/events/' + event.id + '/form.zip?access_token=' + token}}"> <i cl***REMOVED***="fa fa-sign-out"></i> Export Form</a>
          <a cl***REMOVED***="btn btn-danger right" ng-show="event.id" ng-click="deleteEvent(event)"> <i cl***REMOVED***="fa fa-trash-o"></i> Delete Event</a>

          <h2 cl***REMOVED***="top-gap-l">Teams</h2>
          <div cl***REMOVED***="bottom-gap">
            <div cl***REMOVED***="row">
              <form cl***REMOVED***="form">
                <div cl***REMOVED***="col-md-3">
                  <ui-select ng-model="team.selected" theme="bootstrap">
                    <ui-select-match placeholder="Select a team to add to event">{{$select.selected.name}}</ui-select-match>
                    <ui-select-choices repeat="team in nonTeams | orderBy: 'name' | filter: $select.search">
                      <div ng-bind-html="team.name | highlight: $select.search"></div>
                    </ui-select-choices>
                  </ui-select>
                 </div>
                 <div cl***REMOVED***="col-md-2 pull-left">
                   <button cl***REMOVED***="btn btn-success" ng-click="addTeam(team.selected)" ng-disabled="team.selected == null"><i cl***REMOVED***="fa fa-plus"></i> Add Team</button>
                 </div>
              </form>
            </div>
          </div>


          <div cl***REMOVED***="navbar navbar-default">
            <div cl***REMOVED***="container-fluid">
             <div cl***REMOVED***="">
               <ul cl***REMOVED***="nav navbar-nav navbar-left">
                 <li><button type="button" cl***REMOVED***="btn btn-default btn-sm navbar-btn navbar-left" ng-click="teamsEdit = !teamsEdit">Edit</button></li>
               </ul>

               <ul cl***REMOVED***="nav navbar-nav">
                 <li><a cl***REMOVED***="navbar-brand" style="margin-left: 5px;">Team Members ({{eventTeams.length}})</a></li>
                 <li cl***REMOVED***="active">
                   <form cl***REMOVED***="navbar-form">
                     <input type="text" cl***REMOVED***="search-query form-control" placeholder="Filter Teams" ng-model="teamSearch">
                   </form>
                 </li>
               </ul>
             </div>
           </div>
         </div>

          <div cl***REMOVED***="pre-scrollable-large well well-small admin-table">
            <div ng-repeat="team in eventTeams | filter:teamSearch | orderBy:'name'" cl***REMOVED***="row well-item">
              <div cl***REMOVED***="col-md-12">
                <span cl***REMOVED***="admin-table-delete-btn" ng-show="teamsEdit">
                  <a cl***REMOVED***="btn btn-xs btn-danger" ng-click="removeTeam(team)"><i cl***REMOVED***="fa fa-minus"></i></a>
                </span>

                <div>
                  <span cl***REMOVED***="strong">
                    {{team.name}}
                  </span>
                </div>
                <div>
                  <span cl***REMOVED***="muted">{{team.description}}</span>
                </div>
              </div>
            </div>
          </div>

          <h2 cl***REMOVED***="top-gap">Layers</h2>
          <div cl***REMOVED***="bottom-gap">
            <div cl***REMOVED***="row">
              <form cl***REMOVED***="form">
                <div cl***REMOVED***="col-md-3">
                  <ui-select ng-model="layer.selected" theme="bootstrap">
                    <ui-select-match placeholder="Select a layer to add to event">{{$select.selected.name}}</ui-select-match>
                    <ui-select-choices group-by="groupLayerByType" repeat="layer in nonLayers | orderBy: 'name' | filter: $select.search">
                      <div ng-bind-html="layer.name | highlight: $select.search"></div>
                    </ui-select-choices>
                  </ui-select>
                 </div>
                 <div cl***REMOVED***="col-md-2 pull-left">
                   <button cl***REMOVED***="btn btn-success" ng-click="addLayer(layer.selected)" ng-disabled="layer.selected == null"><i cl***REMOVED***="fa fa-plus"></i> Add Layer</button>
                 </div>
              </form>
            </div>
          </div>

          <div cl***REMOVED***="navbar navbar-default">
            <div cl***REMOVED***="container-fluid">
             <div cl***REMOVED***="">
               <ul cl***REMOVED***="nav navbar-nav navbar-left">
                 <li><button type="button" cl***REMOVED***="btn btn-default btn-sm navbar-btn navbar-left" ng-click="layersEdit = !layersEdit">Edit</button></li>
               </ul>

               <ul cl***REMOVED***="nav navbar-nav">
                 <li><a cl***REMOVED***="navbar-brand" style="margin-left: 5px;">Layers ({{eventLayers.length}})</a></li>
                 <li cl***REMOVED***="active">
                   <form cl***REMOVED***="navbar-form">
                     <input type="text" cl***REMOVED***="search-query form-control" placeholder="Filter Layers" ng-model="layerSearch">
                   </form>
                 </li>
               </ul>
             </div>
           </div>
         </div>

          <div cl***REMOVED***="pre-scrollable-large well well-small admin-table">
            <div ng-repeat="layer in eventLayers | filter:layerSearch | orderBy:'name'" cl***REMOVED***="row well-item">
              <div cl***REMOVED***="col-md-12">
                <span cl***REMOVED***="admin-table-delete-btn" ng-show="layersEdit">
                  <a cl***REMOVED***="btn btn-xs btn-danger" ng-click="removeLayer(layer)"><i cl***REMOVED***="fa fa-minus"></i></a>
                </span>
                <div>
                  <span cl***REMOVED***="strong">
                    {{layer.name}}
                  </span>
                  <i cl***REMOVED***="muted icon-spacer">{{layer.type}}</i>
                </div>
                <div>
                  <span cl***REMOVED***="muted">{{layer.description}}</span>
                </div>
              </div>
            </div>
          </div>

          <button cl***REMOVED***="btn btn-success right" ng-hide="event.id" ng-click="createEvent(event)"> <i cl***REMOVED***="fa fa-thumbs-o-up"></i> Create Event</button>

        </div>

        <div ng-if="event.id">
            <h2 cl***REMOVED***="top-gap-xl">Form
              <a ng-href="{{'/api/events/' + event.id + '/form.zip?access_token=' + token}}">
                <span cl***REMOVED***="fa-stack" style="font-size: 18px;">
                  <i cl***REMOVED***="fa fa-square fa-stack-2x"></i>
                  <i cl***REMOVED***="fa fa-download fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </h2>

            <div cl***REMOVED***="form-fields">
              <h4>Fields</h4>
              <p ng-show="event.form.fields.length == 0">No fields added yet.</p>
              <div cl***REMOVED***="well">
                <accordion close-others="accordion.oneAtATime">
                  <accordion-group heading="{{field.title}}" ng-repeat="field in event.form.fields | filter:{archived: '!true'} track by field.id">
                    <div cl***REMOVED***="accordion-edit">
                      <button ng-show="deletableField(field)" cl***REMOVED***="btn btn-danger pull-right" type="button" ng-click="deleteField(field.id)"><i cl***REMOVED***="fa fa-trash icon-white"></i> Delete</button>
                        <form>
                          <div cl***REMOVED***="row">
                            <div cl***REMOVED***="col-md-2">
                              <div cl***REMOVED***="form-group">
                                 <label>Type</label>
                                 <input type="text" value="{{field.type}}" cl***REMOVED***="form-control" disabled>
                               </div>
                             </div>
                           </div>

                           <div cl***REMOVED***="row">
                             <div cl***REMOVED***="col-md-2">
                               <div cl***REMOVED***="form-group">
                                  <label>Title</label>
                                  <input type="text" ng-change="autoSave()" ng-model="field.title" value="{{field.title}}" cl***REMOVED***="form-control">
                                </div>
                              </div>
                            </div>

                            <div cl***REMOVED***="row">
                              <div cl***REMOVED***="col-md-2">
                                <div cl***REMOVED***="form-group" ng-hide="showAddOptions(field)">
                                   <label>Default Value</label>
                                   <input ng-show="field.type=='checkbox'" ng-model="field.value" id="{{field.id}}" type="checkbox" ng-change="autoSave()" ng-checked="field.value == true" ng-required="field.required"/>
                                   <input ng-hide="field.type=='checkbox'" type="text" ng-change="autoSave()" ng-model="field.value" value="{{field.value}}" cl***REMOVED***="form-control">
                                </div>
                              </div>
                            </div>

                            <div cl***REMOVED***="row">
                              <div cl***REMOVED***="col-md-2">
                                <div cl***REMOVED***="form-group" ng-show="showAddOptions(field)">
                                   <label>Default Value</label>
                                   <select ng-model="field.value" ng-change="autoSave()" ng-options="choice.title as choice.title for choice in field.choices" cl***REMOVED***="form-control">
                                     <option value="">No Default</option>
                                   </select>
                                </div>
                              </div>
                            </div>

                            <div cl***REMOVED***="row">
                              <div cl***REMOVED***="col-md-2">
                                <div cl***REMOVED***="form-group" ng-show="showAddOptions(field)">
                                  <label>Field Options</label>

                                  <div ng-repeat="option in field.choices" cl***REMOVED***="row bottom-gap">
                                    <div cl***REMOVED***="col-sm-12">
                                      <span cl***REMOVED***="admin-table-delete-btn"><a cl***REMOVED***="btn btn-danger btn-xs pull-left" type="button" ng-click="deleteOption(field, option)"><i cl***REMOVED***="fa fa-minus icon-white"></i></a></span>
                                      {{option.title}}
                                    </div>
                                  </div>

                                  <div cl***REMOVED***="row">
                                    <div cl***REMOVED***="col-md-10">
                                      <input type="text" ng-model="newOptionTitle" cl***REMOVED***="form-control">
                                    </div>
                                    <div cl***REMOVED***="col-md-2">
                                      <button cl***REMOVED***="btn btn-primary" type="button" ng-click="addOption(field, newOptionTitle); newOptionTitle = '';"><i cl***REMOVED***="fa fa-plus"></i> Add Option</button>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>

                            <div cl***REMOVED***="checkbox" ng-show="field.name != 'timestamp' &amp;&amp; field.name != 'geometry' &amp;&amp; field.name != 'type'">
                              <label>
                                <input type="checkbox" ng-model="field.required"  ng-change="autoSave()"> Required
                              </label>
                            </div>

                        </form>
                      </div>
                    </accordion-group>
                  </accordion>

                  <div cl***REMOVED***="add-field">
                    <h3>Add A New Field</h3>
                    <div cl***REMOVED***="well">
                      <form>
                        <div cl***REMOVED***="row">
                          <div cl***REMOVED***="col-md-2">
                            <div cl***REMOVED***="form-group">
                               <label>Type</label>
                               <select ng-model="newField.type" ng-options="type.name as type.value for type in fieldTypes" cl***REMOVED***="form-control"></select>
                             </div>
                           </div>
                         </div>

                         <div cl***REMOVED***="row">
                           <div cl***REMOVED***="col-md-2">
                             <div cl***REMOVED***="form-group">
                                <label>Title</label>
                                <input type="text" ng-model="newField.title" value="{{newField.title}}" cl***REMOVED***="form-control">
                              </div>
                            </div>
                          </div>

                          <div cl***REMOVED***="row" ng-hide="newField.type=='checkbox'">
                            <div cl***REMOVED***="col-md-2">
                              <div cl***REMOVED***="form-group" ng-hide="showAddOptions(newField)">
                                 <label>Default Value</label>
                                 <input ng-hide="newField.type=='checkbox'" type="text" ng-model="newField.value" value="{{newField.value}}" cl***REMOVED***="form-control">
                              </div>
                            </div>
                          </div>

                          <div cl***REMOVED***="checkbox" ng-show="newField.type=='checkbox'">
                            <label>
                              <input ng-model="newField.value" type="checkbox" ng-checked="newField.value == true"/> Default Value
                            </label>
                          </div>

                          <div cl***REMOVED***="row">
                            <div cl***REMOVED***="col-md-2">
                              <div cl***REMOVED***="form-group" ng-show="showAddOptions(newField)">
                                 <label>Default Value</label>
                                 <select ng-model="newField.value" ng-options="choice.title as choice.title for choice in newField.choices" cl***REMOVED***="form-control">
                                   <option value="">No Default</option>
                                 </select>
                              </div>
                            </div>
                          </div>

                          <div cl***REMOVED***="row">
                            <div cl***REMOVED***="col-md-2">
                              <div cl***REMOVED***="form-group" ng-show="showAddOptions(newField)">
                                <label>Field Options</label>

                                <div ng-repeat="option in newField.choices" cl***REMOVED***="row bottom-gap">
                                  <div cl***REMOVED***="col-sm-12">
                                    <span cl***REMOVED***="admin-table-delete-btn"><a cl***REMOVED***="btn btn-danger btn-xs pull-left" type="button" ng-click="deleteOption(newField, option)"><i cl***REMOVED***="fa fa-minus icon-white"></i></a></span>
                                    {{option.title}}
                                  </div>
                                </div>

                                <div cl***REMOVED***="row">
                                  <div cl***REMOVED***="col-md-10">
                                    <input type="text" ng-model="newFieldNewOptionTitle" cl***REMOVED***="form-control">
                                  </div>
                                  <div cl***REMOVED***="col-md-2">
                                    <button cl***REMOVED***="btn btn-primary" type="button" ng-click="addOption(newField, newFieldNewOptionTitle); newFieldNewOptionTitle = '';"><i cl***REMOVED***="fa fa-plus"></i> Add Option</button>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>

                          <div cl***REMOVED***="checkbox">
                            <label>
                              <input type="checkbox" ng-model="newField.required" ng-init="newField.required = true"> Required
                            </label>
                          </div>
                       </form>

                      <button type="submit" cl***REMOVED***="btn btn-primary" ng-click="addNewField()"><i cl***REMOVED***="fa fa-plus-square-o"></i> Add Field</button>
                    </div>
                  </div>
                </div>

                <div cl***REMOVED***="symbology">
                  <h3>Symbology</h3>
                  <div cl***REMOVED***="well">
                    <div cl***REMOVED***="row">
                      <div cl***REMOVED***="col-md-12">
                        <strong>Default Icon</strong>

                        <form
                          type="button"
                          enctype="multipart/form-data"
                          file-upload url="{{'/api/events/' + event.id + '/form/icons' + '?access_token=' + token}}"
                          allow-upload="event.id"
                          preview="true"
                          upload-file-form-name="'icon'">
                      </form>
                      </div>
                  </div>
                </div>

                <h4>Choose a field to be used for icon variants:</h4>
                <div cl***REMOVED***="row bottom-gap">
                  <div cl***REMOVED***="col-md-2">
                    <select ng-model="event.form.variantField" ng-change="variantChanged()" ng-options="field.name as field.title for field in event.form.fields | filter: variantFilter" cl***REMOVED***="form-control">
                      <option value="">No Variant</option>
                    </select>
                  </div>
                </div>

                <div ng-show="showNumberVariants" cl***REMOVED***="bottom-gap">
                  <h4>You have chosen a date field for your icon variants.  Please define the ranges for each variant.</h4>
                  <div ng-repeat="variant in variants" cl***REMOVED***="row bottom-gap">
                    <div cl***REMOVED***="col-md-12">
                      <span cl***REMOVED***="strong">{{variant.title}}
                        <span ng-show="variants[$index+1]">
                          - {{variants[$index+1].title}}
                        </span>
                        <span ng-hide="variants[$index+1]">+</span>
                        minutes old
                        <button cl***REMOVED***="btn btn-sm btn-danger" ng-click="removeVariant(variant)">Remove Variant</button>
                      </span>
                    </div>
                  </div>
                  <div cl***REMOVED***="row">
                    <div cl***REMOVED***="col-md-12">
                      <form cl***REMOVED***="form-inline">
                        <div cl***REMOVED***="form-group">
                          <p cl***REMOVED***="form-control-static">More than</p>
                        </div>
                        <div cl***REMOVED***="form-group">
                          <input type="number" ng-model="newVariantMin" cl***REMOVED***="form-control"/>
                        </div>
                        <div cl***REMOVED***="form-group">
                          <p cl***REMOVED***="form-control-static">minutes old</p>
                        </div>
                        <button cl***REMOVED***="btn btn-sm btn-primary" ng-click="addVariantOption(newVariantMin)">Add Variant</button>
                      </form>
                    </div>
                  </div>
                </div>

                <div cl***REMOVED***="well">
                  <div cl***REMOVED***="row" ng-repeat="option in typeField.choices">
                    <div cl***REMOVED***="row bottom-gap-s">
                      <div cl***REMOVED***="col-md-12">
                        <strong>{{option.title}}</strong>
                      </div>
                    </div>
                    <div cl***REMOVED***="row bottom-gap-l">
                      <div cl***REMOVED***="col-md-1">
                        <div cl***REMOVED***="row">
                          <div cl***REMOVED***="col-md-12">Default</div>
                        </div>
                        <form
                          type="button"
                          enctype="multipart/form-data"
                          file-upload url="{{'/api/events/' + event.id + '/form/icons/' + option.title + '?access_token=' + token + '&_dc=' + savedTime}}"
                          allow-upload="event.id"
                          preview="true"
                          upload-file-form-name="'icon'">
                        </form>
                      </div>
                    <div cl***REMOVED***="col-md-1" ng-repeat="variant in variants">
                      <div cl***REMOVED***="row">
                        <div cl***REMOVED***="col-md-12">
                          <span>
                            {{variant.title}}
                            <span ng-show="variantField.type == 'date'">
                              <span ng-show="variants[$index+1]">
                                - {{variants[$index+1].title}}
                              </span>
                              <span ng-hide="variants[$index+1]">+</span>
                              minutes old
                            </span>
                          </span>
                        </div>
                      </div>
                      <form
                        type="button"
                        enctype="multipart/form-data"
                        file-upload url="{{'/api/events/' + event.id + '/form/icons/' + option.title + '/' + variant.title + '?access_token=' + token + '&_dc=' + savedTime}}"
                        allow-upload="event.id"
                        preview="true"
                        upload-file-form-name="'icon'">
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          <div cl***REMOVED***="form-fields-preview well">
            <h3>Form Preview</h3>
            <form-directive form="event.form" form-preview="true"></form-directive>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>
