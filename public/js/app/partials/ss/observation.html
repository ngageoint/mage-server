<div 
  id="observation-panel" 
  ng-show="checkCurrentMapPanel('observation')" 
  cl***REMOVED***="tabbable tabs-below panel panel-large">
  <div cl***REMOVED***="pull-right panel-close">
    <i ng-click="cancelObservation()" ngm-tap="cancelObservation()" cl***REMOVED***="close">&times;</i>
  </div>

  <div cl***REMOVED***="panel-content">

    <div cl***REMOVED***="row-fluid feature-title">
      <div cl***REMOVED***="span2">
        <div cl***REMOVED***="awesome-marker awesome-marker-display" ng-cl***REMOVED***="markerColor">
          <i cl***REMOVED***="icon-white" ng-cl***REMOVED***="markerCl***REMOVED***"></i>
        </div>
      </div>    
      <div cl***REMOVED***="span10">
        <div>
          <span cl***REMOVED***="muted">
            <strong user-id="observation.attributes.userId">{{user.firstname}} {{user.lastname}}</strong>
            <span ui-if="observation.attributes.deviceId" device-id="observation.attributes.deviceId">({{device.uid}})</span>
          </span>
        </div>
        <div>
          <span cl***REMOVED***="muted ng-binding">{{formatFeatureDate(observation.attributes.EVENTDATE)}} @ {{featureLocation.lat.toPrecision(7)}}, {{featureLocation.lng.toPrecision(7)}} </span>
        </div>
      </div>
    </div>

    <ul cl***REMOVED***="nav nav-pills">
      <li ng-cl***REMOVED***="{active: observationTab == 1}">
        <a href="" ng-click="observationTab = 1;">
          <i cl***REMOVED***="icon-list" style="background-image: none;"></i> 
          Details
        </a>
      </li>
      <li ng-cl***REMOVED***="{active: observationTab == 2}">
        <a href="" ng-click="observationTab = 2;">
          <i cl***REMOVED***="icon-camera" style="background-image: none;"></i> 
          Media
        </a>
      </li>
    </ul>
    <div cl***REMOVED***="tab-content" ng-show="observationTab == 1">
      <form cl***REMOVED***="form-horizontal">
        <div cl***REMOVED***="control-group">
          <label cl***REMOVED***="control-label" for="type">Layer</label>
          <div cl***REMOVED***="controls">
            <select ng-model="currentLayerId" ng-selected="currentLayerId" ng-options="layer.id as layer.name for layer in featureLayers"></select>
          </div>
        </div>
        <div cl***REMOVED***="control-group">
          <label cl***REMOVED***="control-label" for="type">Type</label>
          <div cl***REMOVED***="controls">
            <select ng-model="observation.attributes.TYPE" ng-selected="type.name" ng-options="type.name as type.name for type in types"></select>
          </div>
        </div>
        <div cl***REMOVED***="control-group">
          <label cl***REMOVED***="control-label" for="team">Team</label>
          <div cl***REMOVED***="controls">
            <select ng-model="observation.attributes.TEAM" ng-selected="team" ng-options="team for team in teams"></select>
          </div>
        </div>
        <div cl***REMOVED***="control-group">
          <label cl***REMOVED***="control-label" for="unit">Description</label>
          <div cl***REMOVED***="controls">
            <textarea ng-model="observation.attributes.DESCRIPTION"></textarea>
          </div>
        </div>
      </form>
      <span cl***REMOVED***="pull-right">
        <button cl***REMOVED***="btn btn-inverse" ng-click="cancelObservation()" ngm-tap="cancelObservation()">{{observationCloseText}}</button>
        <button cl***REMOVED***="btn" ng-click="saveObservation()" ngm-tap="saveObservation()"><i cl***REMOVED***="icon-save"></i> Save</button>
      </span>
      <span>
        <button cl***REMOVED***="btn btn-danger pull-left" ng-show="amAdmin" ng-click="deleteObservation()" ngm-tap="deleteObservation()"><i cl***REMOVED***="icon-trash"></i> Delete</button>
      </span>
    </div>
    <!-- Start of tab2 -->
    <div cl***REMOVED***="tab-content" ng-show="observationTab == 2" style="height: 900px;">
      <form>
        <div cl***REMOVED***="control-group">
          <label cl***REMOVED***="control-label" for="unit">Select File</label>
          <div cl***REMOVED***="controls">
            <input type="file" id="file-upload" accept="audio/*|video/*|image/*" capture="camera" ng-model-instant multiple onchange="angular.element(this).scope().setFiles(this)">
          </div>
          <div ng-show="progressVisible">
            <div cl***REMOVED***="percent">{{progress}}%</div>
            <div cl***REMOVED***="progress-bar">
                <div cl***REMOVED***="uploaded" ng-style="{'width': progress+'%'}"></div>
            </div>
          </div>
        </div>
      </form>
      <span>
        <button cl***REMOVED***="btn btn-inverse" ng-click="cancelObservation()" ngm-tap="cancelObservation()">{{observationCloseText}}</button>
        <button cl***REMOVED***="btn" ng-click="saveObservation()" ngm-tap="saveObservation()"><i cl***REMOVED***="icon-save"></i> Save</button>
      </span>
      <hr>
      
      <div cl***REMOVED***="attachment" ng-repeat="attachment in attachments">
        <div cl***REMOVED***="image-button">
          <div ng-switch on="attachment.contentType">
            <!--<img ng-switch-when="image/jpg" ng-src="{{attachmentUrl + attachment.id + '?access_token=' + token}}" style="width:100%">-->
            <img ng-switch-when="image/jpg" ng-src="img/mapcache.png" style="width:100%">
            <img ng-switch-when="image/jpeg" ng-src="{{attachmentUrl + attachment.id + '?access_token=' + token}}" style="width:100%">
            <img ng-switch-when="image/png" ng-src="{{attachmentUrl + attachment.id + '?access_token=' + token}}" style="width:100%">
            <img ng-switch-when="image/gif" ng-src="{{attachmentUrl + attachment.id + '?access_token=' + token}}" style="width:100%">
            <input type="button" value="Delete" ng-show="amAdmin && (attachment.contentType != 'application/octet-stream')" cl***REMOVED***="btn btn-danger" ng-click="deleteAttachment(attachment.id)">
            <!-- Fix for octet stream images in an older version of the app -->
            <!-- Due to drastically varying browser behavior, videos will be a download link for the time being -->
            <a ng-switch-when="video/mp4" ng-href="{{attachmentUrl + attachment.id + '?access_token=' + token}}">Download video</a>
            <div ng-switch-when="application/octet-stream" cl***REMOVED***="top-gap-l" style="width: 100%">
              <a ng-href="{{attachmentUrl + attachment.id + '?access_token=' + token}}" target="_blank">Download {{attachment.name}}</a>
              <div><a ng-show="amAdmin" cl***REMOVED***="btn btn-danger" ng-click="deleteAttachment(attachment.id)">Delete</a></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
