<div>  
  <!-- The map directive -->
  <div id="map" cl***REMOVED***="map-wrap leaflet-container">
    <div leaflet marker-location="markerLocation" baselayer="baseLayer" layer="layer" message="message" draggable="true" active-feature="activeFeature" newfeature="newFeature" currentlayerid="currentLayerId" position="position" position-broadcast="positionBroadcast" locations="locations"></div>
  </div>

  <div ss-observation active-feature="activeFeature" new-feature="newFeature" marker-location="markerLocation"></div>
  <!-- <div pdc-observation active-feature="activeFeature" new-feature="newFeature" marker-location="markerLocation"></div> -->
  <!-- <div ***REMOVED***-observation active-feature="activeFeature"></div> -->

  <!-- Third party observation dialog. Might be a good idea to generalize all the things and make them one observation panel at some point in time. -->
  <!-- <div external active-feature="activeFeature" currentlayerid="currentLayerId" layers="layers"></div> -->
  
  <!-- layer picker button -->
  <button cl***REMOVED***="btn" id="settings" ng-click="openSettings()" ngm-tap="openSettings()"><i cl***REMOVED***="icon-layers icon-sage"></i></button>
  <button cl***REMOVED***="btn" id="export" ng-click="openExport()" ngm-tap="openExport()"><i cl***REMOVED***="icon-cloud-download icon-sage"></i></button>

  <!-- Button bar -->
  <div id="button-bar">
    <button 
      id="geo" 
      cl***REMOVED***="btn" 
      ng-cl***REMOVED***="{true: 'btn-inverse'}[locate]"
      ng-click="toggleLocate()" 
      ngm-tap="toggleLocate()">
      <i cl***REMOVED***="icon-target" ng-cl***REMOVED***="{true: 'icon-sage-inverse', false: 'icon-sage'}[locate]"></i>
    </button>

    <button cl***REMOVED***="btn hide" id="goto-address" ng-click="openGotoAddress()" ngm-tap="openGotoAddress()">
      <i cl***REMOVED***="icon-search icon-sage"></i>
    </button>

    <button cl***REMOVED***="btn" id="new-observation" ng-click="newObservation()" ngm-tap="newObservation()">
      <i cl***REMOVED***="icon-plus icon-sage"></i>
    </button>

    <button 
      id="broadcast-location-btn" 
      cl***REMOVED***="btn"
      ng-cl***REMOVED***="{true: 'btn-inverse'}[broadcast]"
      ng-click="toggleBroadcast()" 
      ngm-tap="toggleBroadcast()">
      <i cl***REMOVED***="icon-megaphone" ng-cl***REMOVED***="{true: 'icon-sage-inverse', false: 'icon-sage'}[broadcast]"></i>
    </button>

    <button
      id="locations-btn"
      cl***REMOVED***="btn" 
      ng-cl***REMOVED***="{true: 'btn-inverse'}[locationServicesEnabled]" 
      ng-click="locationServicesEnabled = !locationServicesEnabled;locationServices(); showLocations = !showLocations" 
      ngm-tap="locationServicesEnabled = !locationServicesEnabled;locationServices(); showLocations = !showLocations">
      <i cl***REMOVED***="icon-users" ng-cl***REMOVED***="{true: 'icon-sage-inverse', false: 'icon-sage'}[locationServicesEnabled]"></i>
    </button>

    <button
      id="list-tool-btn"
      cl***REMOVED***="btn" 
      ng-cl***REMOVED***="{true: 'btn-inverse'}[showListTool]" 
      ng-click="showListTool = !showListTool" 
      ngm-tap="showListTool = !showListTool">
      <i cl***REMOVED***="icon-list" ng-cl***REMOVED***="{true: 'icon-sage-inverse', false: 'icon-sage'}[showListTool]"></i>
    </button>

  </div>

  <!-- Panels -->
  <!-- Settings panel -->
  <div id="settings-panel" ng-show="showSettings" cl***REMOVED***="panel panel-large">
    <div cl***REMOVED***="pull-right panel-close">
      <i ng-click="showSettings = false" ngm-tap="showSettings = false" cl***REMOVED***="close">&times;</i>
    </div>
    <div cl***REMOVED***="panel-content">
      <form cl***REMOVED***="form">
        <h4>Base Layers</h4>
        <div cl***REMOVED***="control-group">
          <div cl***REMOVED***="controls">
            <select ng-model="baseLayer" ng-options="baseLayer.name for baseLayer in baseLayers"></select>
          </div>
        </div>

        <div ng-show="featureLayers.length > 0">
          <div style="display: inline-block;">
            <h4>Feature Layers</h4>
          </div>
          <div cl***REMOVED***="control-group">
            <div cl***REMOVED***="controls">
              <label cl***REMOVED***="checkbox" ng-repeat="layer in featureLayers">
                <input type="checkbox" ng-model="layer.checked" ng-click="onFeatureLayer(layer)"/>{{layer.name}}
                <i cl***REMOVED***="icon-globe icon-spin" ng-show="loadingLayers[layer.id]" style="margin-left: 7px;"></i>
              </label>
            </div>
          </div>
        </div>

        <div ng-show="externalLayers.length > 0">
          <h4>External Layers</h4>
          <div cl***REMOVED***="control-group">
            <div cl***REMOVED***="controls">
              <label cl***REMOVED***="checkbox" ng-repeat="layer in externalLayers">
                <input type="checkbox" ng-model="layer.checked" ng-click="onFeatureLayer(layer)"/>{{layer.name}}
                <i cl***REMOVED***="icon-globe icon-spin" ng-show="loadingLayers[layer.id]" style="margin-left: 7px;"></i>
              </label>
            </div>
          </div>
        </div>

        <div ng-show="imageryLayers.length > 0">
          <h4>Imagery Layers</h4>
          <div cl***REMOVED***="control-group">
            <div cl***REMOVED***="controls">
              <label cl***REMOVED***="checkbox" ng-repeat="layer in imageryLayers">
                <input type="checkbox" ng-model="layer.checked" ng-click="onImageryLayer(layer)"/>{{layer.name}}
              </label>
            </div>
          </div>
        </div>
      </form>
      
      <span>
        <button cl***REMOVED***="btn btn-mobile" ng-click="closeSettings()" ngm-tap="closeSettings()">Close</button>
      </span>
    </div>
  </div>

  <!-- Export panel -->
  <div id="export-panel" ng-show="showExport" cl***REMOVED***="panel panel-large">
    <div cl***REMOVED***="pull-right panel-close">
      <i ng-click="closeExport()" ngm-tap="closeExport()" cl***REMOVED***="close">&times;</i>
    </div>
    <div cl***REMOVED***="panel-content">
      <h3>Export to KML</h3>
      <form cl***REMOVED***="form">  
        <div cl***REMOVED***="top-gap">
          <i cl***REMOVED***="icon-layers icon-sage pull-left icon-spacer"></i>    
          <h4>Select Layers</h4>
        </div>
        <div cl***REMOVED***="control-group">
          <div cl***REMOVED***="controls">
            <label cl***REMOVED***="checkbox" ng-repeat="layer in featureLayers">
              <input type="checkbox" ng-click="addExportLayer(layer)">{{layer.name}}
            </label>
            <label cl***REMOVED***="checkbox">
              <input type="checkbox" ng-model="fft_layer">Friendly Forces
            </label>
          </div>
        </div>
        <div cl***REMOVED***="top-gap">
          <i cl***REMOVED***="icon-filter icon-sage pull-left icon-spacer"></i>
          <h4>Filter Output</h4>
        </div>
        <div>Time Range:</div>
        <div style="margin: 0px, 0px, 0px, 20px">
          <select ng-model="time_filter">
            <option value="300">Last 5 Minutes</option>
            <option value="3600">Last Hour</option>
            <option value="43200">Last 12 Hours</option>
            <option value="86400">Last 24 Hours</option>
            <option value="-1">All (Use With Caution)</option>
          </select>
      </div>
      </form>
      <button cl***REMOVED***="btn btn-inverse" ng-click="closeExport()" ngm-tap="closeExport()">Cancel</button>
      <button cl***REMOVED***="btn" ng-click="export()" ngm-tap="export()">Export</button>
      <div id="export-error-message" cl***REMOVED***="top-gap alert alert-error" style="display: none;"></div>
    </div>
  </div>

  <div id="goto-address-panel" ng-show="showGoToAddress" cl***REMOVED***="panel panel-medium">
    <form cl***REMOVED***="form-horizontal">
      <div cl***REMOVED***="control-group">
        <label cl***REMOVED***="control-label" for="address">Go to Address</label>
        <div cl***REMOVED***="controls">
          <input ng-model="address"/>
        </div>
      </div>
      <span>
        <button cl***REMOVED***="btn btn-inverse" ng-click="dismissGotoAddress()" ngm-tap="dismissGotoAddress()">Cancel</button>
        <button cl***REMOVED***="btn" ng-click="gotoAddress()" ngm-tap="gotoAddress()">Go</button>
      </span>
    </form>
  </div>

  <div id="refresh-panel" ng-show="showRefresh" cl***REMOVED***="panel panel-small">
    <i cl***REMOVED***="icon-spin icon-spinner icon-large"></i> Synchronizing
    <span>
      <button cl***REMOVED***="btn" ng-click="dismissRefresh()" ngm-tap="dismissRefresh()">Ok</button>
    </span>
  </div>
<!--
   <div id="location-panel" ng-show="showLocations" cl***REMOVED***="right-panel panel-large">
    <div data-ng-repeat="location in locations | orderBy: 'locations[0].properties.timestamp':true">
      <h6><span user-id="location.user">{{user.firstname}} {{user.lastname}}</span> @ {{location.locations[0].properties.timestamp | date : 'medium'}}</h6>
    </div>
  </div>
  -->
  <div id="list-tool-panel" ng-show="showListTool">
    <div cl***REMOVED***="navbar">
      <div cl***REMOVED***="navbar-inner">
        <div cl***REMOVED***="container">
          <ul cl***REMOVED***="nav navbar-nav">
            <li ng-cl***REMOVED***="userFilterCl***REMOVED***('all')"><a href="" ng-click="changeCurrentUserFilter('all')">All Observations</a></li>
            <li ng-cl***REMOVED***="userFilterCl***REMOVED***('active')"><a href="" ng-click="changeCurrentUserFilter('active')">Last 30m</a></li>
            <li ng-cl***REMOVED***="userFilterCl***REMOVED***('unregistered')"><a href="" ng-click="changeCurrentUserFilter('unregistered')">2 Hours</a></li>
            <li ng-cl***REMOVED***="userFilterCl***REMOVED***('active')"><a href="" ng-click="changeCurrentUserFilter('active')">6 hours</a></li>
            <li ng-cl***REMOVED***="userFilterCl***REMOVED***('active')"><a href="" ng-click="changeCurrentUserFilter('active')">12 hours</a></li>
            <li ng-cl***REMOVED***="userFilterCl***REMOVED***('active')"><a href="" ng-click="changeCurrentUserFilter('active')">24 hours</a></li>
          </ul>
          <form cl***REMOVED***="navbar-search pull-right">
            <input type="text" cl***REMOVED***="form-search search-query" ng-model="userQuery" placeholder="Search" ng-change="userSearch()">
          </form>
        </div>
      </div>
    </div>
    <div id="list-tool-list" cl***REMOVED***="top-gap-s">
      <div cl***REMOVED***="row" ng-cl***REMOVED***="activeFeature.featureId == feature.properties.OBJECTID && 'feature-row-selected'" ng-repeat="feature in layer.features.features | orderBy: 'properties.EVENTDATE' : true">
        <a ng-click="setActiveFeature(feature, layer)">
          <div cl***REMOVED***="span1"><span style="margin-left: 20px" ng-bind-html-u***REMOVED***fe="iconTag(feature)"></span></div>
          <div cl***REMOVED***="span2">{{feature.properties.TYPE}}</div>
          <div cl***REMOVED***="span2">{{feature.properties.EVENTLEVEL}}</div>
          <div cl***REMOVED***="span2">{{feature.properties.EVENTDATE | date: 'medium'}}</div>
          <div ng-show="feature.attachments.length == 0"><i cl***REMOVED***="icon-paper-clip"></i></div>
        </a>
      </div>
  </div>

</div>